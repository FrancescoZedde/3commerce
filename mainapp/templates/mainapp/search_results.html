{% extends 'mainapp/base.html' %}

{% load crispy_forms_tags %}

{% load static %}

{% block content %}

<div class="standard-command-container">
    <div style="text-align: center; margin-bottom:1em;">
        <button id="open-actions-panel-button" class="btn" onclick="control_actions_panel()">
          <i class="fa fa-sort-desc fa-2x"></i>
        </button>
        <button id="close-actions-panel-button" class="btn" hidden="hidden" onclick="control_actions_panel()">
          <i class="fa fa-sort-asc fa-2x"></i>
        </button>
      </div>

    <div id="search-panel" hidden="hidden">
    <!-- Tab navigation section -->
    <ul class="nav nav-pills mb-3" id="myTab" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" id="cj-tab" data-toggle="tab" href="#cj" role="tab" aria-controls="cj" aria-selected="true">CJ Dropshipping</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="aliexpress-tab" data-toggle="tab" href="#aliexpress" role="tab" aria-controls="aliexpress" aria-selected="false">Aliexpress</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="europe-tab" data-toggle="tab" href="#europe" role="tab" aria-controls="europe" aria-selected="false">Europe</button>
      </li>
    </ul>
    
    <!-- Tab content section -->
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="cj" role="tabpanel" aria-labelledby="cj-tab" style="margin-top: 3em;">
        <form action="search-results" method="post">
          <p style="margin-top:5px;margin-bottom:20px;">
          {% csrf_token %}
          {{ cj_search.category | as_crispy_field}}
          {{ cj_search.keywords | as_crispy_field}}
          {{ cj_search.results_limit | as_crispy_field}}
          <div class="button" style="text-align: center;">
            <input class="standard-button" id='searchbycategory' type="submit" value="Search" name="search-by-category">
            <input type="hidden" name="search-mode" value="cj-by-category">
    
          </div>
        </form>
        <form action="search-results" method="post">
          <p style="margin-top:5px;margin-bottom:20px;">
          {% csrf_token %}
          {{ cj_search.search_by_sku | as_crispy_field}}
          <div class="button" style="text-align: center;">
            <input class="standard-button" id='searchbysku' type="submit" value="Search by SKU" name="search-by-sku">
            <input type="hidden" name="search-mode" value="cj-by-sku">
          </div>
        </form>
      </div>
      <div class="tab-pane fade" id="aliexpress" role="tabpanel" aria-labelledby="aliexpress-tab">aliexpress</div>
      <div class="tab-pane fade" id="europe" role="tabpanel" aria-labelledby="europe-tab">europe</div>
    </div> 
</div>
</div>


<div>
    <form action="inventory-import" method="post">
        {% csrf_token %}
        <div class="standard-command-container">
            <input type="hidden" id="products" name="products" value="{{products}}">
            <div style="text-align: center;">
                <input class="standard-button" id='mass-import-inventory' type="submit" value="Mass Import" name="import-inventory" disabled>
            </div>
        </div>
            <input type="hidden" id="selected-items-mass-import" name="selected-items" value="{{selected_items}}">
    </form>
        <div id="card-deck-table">
            {% for group in grouped_products %}
            <div class="card-deck">
                            {% for product in group %}
                            <div class="card shadow" id="card-{{product.productSku}}">
                                <img src={{product.productImage}} style="padding:0.5em;" height="auto" class="card-img-top" alt="...">
                                <div class="card-body">
                                  <p class="card-title" style="font-size:12px !important; min-height:28%">{{ product.productNameEn }}</p>
                                
                                      <p class="card-text"><small class="text-muted"><!--Sku: {{ product.productSku}}<br> --> 
                                             Listings: {{ product.listedNum}} <br> 
                                             <form action="search-product-details" method="post">
                                                {% csrf_token %}
                                                <input style="margin-left:-5px;border:none;color:rgb(73, 167, 255); background-color: transparent;" id='see-details' type="submit" value="See details" name="see-details">
                                                <input type="hidden" id="selected-item-{{ product.productSku}}" name="selected-item" value="{{ product.productSku}}">
                                            </form>
                                        </small>
                                      </p>
                                      <p class="card-text" style="font-size:12px">Price: {{ product.sellPrice }}$</p>
                                      
                                      <form action="inventory-import" method="post">
                                        {% csrf_token %}
                                        <input class="simple-import-button" id='simple-import-inventory' type="submit" value="Import" name="import-inventory">
                                        <input type="hidden" id="selected-item-{{ product.productSku}}" name="selected-item" value="{{ product.productSku}}">
                                     </form>
                                    
                                </div>
                                <div class="card-footer">
                                    <small class="text-muted"><input type="checkbox" id="{{product.productSku}}" name="checkbox-item" onchange="check_checkboxes()"/> Mass Import</small>
                                  </div>
                              </div>
                        {% endfor %}
                </div> 
            {% endfor %}
        </div>

</div>

<script src="{% static 'xz_search_results.js' %}"></script>

<script>
    function filter_results(){
        console.log('test')
        let element = document.getElementById("filters-tab");
        let hidden = element.getAttribute("hidden");
      
        if (hidden) {
           element.removeAttribute("hidden");
           //button.innerText = "Hide filters tab";
        } else {
           element.setAttribute("hidden", "hidden");
           //button.innerText = "Show filters tab";
        }
      }

      function check_checkboxes(){
        console.log('here');
        var selected_items = document.getElementById("selecteditems");
        var check_boxes = document.getElementsByName("checkbox-item")
        var sku_list = []
        check_boxes.forEach(
            function(check_box) {
                if (check_box.checked==true){
                    sku_list.push(check_box.id)
                }
            }
        );
        console.log(sku_list)
        var items_list = document.getElementById("selected-items-mass-import");
        console.log(items_list)
        document.getElementById("selected-items-mass-import").value = sku_list;
        let mass_import_button = document.getElementById("mass-import-inventory");
        console.log(sku_list.length)
        if (sku_list.length > 0) {
            mass_import_button.removeAttribute("disabled");
            //button.innerText = "Hide filters tab";
         } else {
            mass_import_button.setAttribute("disabled", "disabled");
            //button.innerText = "Show filters tab";
         }

      }


      function control_actions_panel() {
          console.log('control_actions_panel')
          let open_panel_button = document.getElementById("open-actions-panel-button");
          let close_panel_button = document.getElementById("close-actions-panel-button");
          let panel = document.getElementById("search-panel");
          
          let hidden = panel.getAttribute("hidden");

          if (hidden) {
            panel.removeAttribute("hidden");
            close_panel_button.removeAttribute("hidden");
            open_panel_button.setAttribute("hidden", "hidden");
            
         } else {
            panel.setAttribute("hidden", "hidden");
            close_panel_button.setAttribute("hidden", "hidden");
            open_panel_button.removeAttribute("hidden");
            
         }
        }
</script>

{% endblock %}

